<div class="container">
  <div class="container-header">
    <h1 *ngIf="type === 'income'">Incomes</h1>
    <h1 *ngIf="type === 'expense'">Expenses</h1>

    <!-- ADD BUTTON -->
    <button class="add-button" *ngIf="!isFormVisible" (click)="toggleForm()">Add</button>
    <button class="close-button" *ngIf="isFormVisible" (click)="toggleForm()">Close</button>
  </div>

  <!-- ADD FORM -->
  <div *ngIf="isFormVisible">
    <app-transaction-form [type]="type"></app-transaction-form>
  </div>

  <!-- ðŸ” FILTERS FORM -->
  <form (submit)="applyFilters()">
    <label>
      Year:
      <select [(ngModel)]="filters.year" name="year">
        <option [value]="''">All</option>
        <option *ngFor="let year of years" [value]="year">{{ year }}</option>
      </select>
    </label>

    <label>
      Month:
      <app-month-dropdown
        [selectedMonth]="filters.month"
        (selectedMonthChange)="onMonthChange($event)">
      </app-month-dropdown>
    </label>

    <label>
      User:
      <app-user-dropdown
        [styleType]="'form'"
        [selectedUser]="filters.userId"
        (selectedUserChange)="onUserChange($event)">
      </app-user-dropdown>
    </label>

    <label>
      Category:
      <app-category-dropdown
        [type]="type"
        [(selectedCategory)]="filters.categoryId"
        (selectedCategoryChange)="onCategoryChange($event)">
      </app-category-dropdown>
    </label>

    <button type="submit">Filter</button>
  </form>

  <!-- ðŸ“Š TABLE -->
  <table>
    <thead>
    <tr>
      <th (click)="setSort('user')">
        User
        <span *ngIf="filters.sortBy === 'user'">
          {{ filters.sortOrder === 'asc' ? 'â–²' : 'â–¼' }}
        </span>
      </th>
      <th (click)="setSort('date')">
        Date
        <span *ngIf="filters.sortBy === 'date'">
          {{ filters.sortOrder === 'asc' ? 'â–²' : 'â–¼' }}
        </span>
      </th>
      <th (click)="setSort('category')">
        Category
        <span *ngIf="filters.sortBy === 'category'">
          {{ filters.sortOrder === 'asc' ? 'â–²' : 'â–¼' }}
        </span>
      </th>
      <th (click)="setSort('amount')">
        Amount
        <span *ngIf="filters.sortBy === 'amount'">
          {{ filters.sortOrder === 'asc' ? 'â–²' : 'â–¼' }}
        </span>
      </th>
      <th (click)="setSort('created')">
        Created
        <span *ngIf="filters.sortBy === 'created'">
        {{ filters.sortOrder === 'asc' ? 'â–²' : 'â–¼' }}
      </span>
      </th>
      <th>Comments</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let transaction of transactions">
      <td>{{ transaction.user?.username || 'No user' }}</td>
      <td>{{ transaction.date | date:'dd.MM.yyyy' }}</td>
      <td>{{ transaction.category?.name }}</td>
      <td>{{ transaction.amount }} â‚¬</td>
      <td>{{ transaction.created | date:'dd.MM.yyyy - HH:mm' }}</td>
      <td>{{ transaction.description }}</td>
    </tr>
    </tbody>
  </table>

  <!-- ðŸ“Œ PAGINATION -->
  <div class="pagination">
    <button (click)="changePage(-1)" [disabled]="filters.page === 0">Back</button>
    <span>Page {{ filters.page + 1 }}</span>
    <button (click)="changePage(1)">Next</button>
  </div>

  <!-- ðŸ“Š SUMMARY -->
  <div class="summary">
    <h3>Summary:</h3>
    <p>PageAmount: {{ pageTotal }} EUR</p>
    <p>All Total (with filters): {{ allTotal }} EUR</p>
  </div>
</div>
